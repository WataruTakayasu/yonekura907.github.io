<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Deferred</title>
</head>
<body>
  <button id="btn" name="button">test</button>

  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script>
  ;(function(){

    $(function(){
      $('#btn').on('click',function () {
        getGreetingMessage('Bob')
        .then(function(successMessage){
          alert(successMessage);
        },function(errorMessage){
          alert(errorMessage);
        });
      });
    });

    var getGreetingMessage = function(name){
      var defer = $.Deferred();

      $.ajax({
        url:'message.txt',
        dataType: 'text',
      }).then(function(text){
        text = text.replace(/NAME/, name);
        defer.resolve(text); // 解決
      },function(){
        defer.reject('失敗しました'); // 却下
      });
      return defer.promise();
    }


  })();
  </script>
</body>
</html>
