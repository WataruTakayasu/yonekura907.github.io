<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Deferred演習</title>
<style>
#character{
  width: 800px;
  height: 800px;
  position: relative;
}
#misoda{
  position: absolute;
  left:0;
  top:0;
}
#kotori{
  position: absolute;
  left:0;
  top:300px;
}
</style>
</head>
<body>

  <div>
    <button id="start-btn" name="button">start</button>
  </div>

  <div id="character">
    <img src="images/misoda.png" id="misoda" alt=""><br>
    <img src="images/kotori.png" id="kotori" alt="">
  </div>


<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<script>
;(function(){

  $(function(){

    setEvent();

  });

  var setEvent = function(){
    $('#start-btn').on('click',function(){
      $(this).off('click');
      start();
    });
  }



  // Deferredオブジェクトを使用して書き換える
  var animeFunc = function() {
    var dfd = $.Deferred();

    $('#misoda').animate({'left':'300px'},function(){
      dfd.resolve();
    });
    return dfd.promise();
  }

  var start = function(){

    animeFunc()
    .then(function(){
      return $('#kotori').animate({'top':'0px'});
    })
    .then(function(){
      return $('#misoda').animate({'top':'300px'});
    })
    .then(function(){
      return $('#kotori').animate({'left':'300px'});
    })
    .then(function(){
      return $('#misoda').animate({'left':'0px'});
    })
    // .then(function(){
    //   setTimeout(function(){
    //     console.log('taiki');
    //     dfd.resolve();
    //   },2000);
    // })
    .then(function(){
      return $('#kotori').animate({'top':'300px'});
    })
    .then(function(){
      return $('#misoda').animate({'top':'0px'});
    })
    .then(function(){
      $('#kotori').animate({'left':'0px'});
      setEvent();
    })
  };

})();
</script>
</body>
</html>
