<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <h1>Ajax演習</h1>
    アクセス先 : http://cshool.com:8888/ex <br>
    リクエストメソッド : GET <br>
    パラメータキー : name <br>
    パラメータ値 : misoda / kotori / zen / all<br>
    <br>
    各パラメータで取得したものを表示してください。<br>
    <br>
    <input type="text" id="input-text">
    <button id="sendEx-btn">演習</button>
    <div id="output-area"></div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript">
    ;(function(){
        var $outputArea = null;
        $(function(){
            $outputArea = $('#output-area');
            $('#sendEx-btn').on('click', function(evt){
                // 値の取得
                var val = $('#input-text').val();
                if(val){
                    var sendData = {name: val};
                    ajax(sendData);
                }
            });
        });

        var ajax = function(aData){
            $.ajax({
                url: 'http://cshool.com:8888/ex',
                type: 'GET',
                dataType: 'json',
                data: aData
            })
            .done(function(data){
                // 表示エリアの削除
                $outputArea.empty();
                // キャラクターの表示
                if(data.status === 'OK'){
                    showOutput(data.character);
                }
                else {
                    showError(data.message);
                }
            })
            .fail(function(){
                console.log('失敗');
            })
        };

        var showOutput = function(aCharacter){
            var divEl = $('<div>');
            for(var cnt=0, len=aCharacter.length; cnt<len; cnt++){
                var o = aCharacter[cnt];
                // コメント部分の生成
                var str = o.name + ' (' + o.age + ') ' + o.comment;
                var commnet = $('<p>').text(str);
                // 画像の表示
                var img = $('<img>').attr('src', o.img);
                // これらをdivでくくっておく。
                divEl.append(img);
                divEl.append(commnet);
            }
            // 表示エリアに表示
            $outputArea.append(divEl);
        };

        var showError = function(aMsg){
            $outputArea.append($('<p>').text( aMsg ));
        };

    })();
    </script>
</body>
</html>